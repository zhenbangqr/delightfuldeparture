<!DOCTYPE html>
<html>

<head>
    <!--
    Semester 1 Assignment
    Delightful Departure Website

    Delightful Departure Reward Page
    Author: Wai Yan Ching
    Date: 16 September 2023
    Filename: reward.html
-->

    <meta charset="utf-8" />
    <meta name="viewport" content="width=1024, height=768" />
    <link href="/stylesheets/main_styles.css" rel="stylesheet" />
    <link href="/stylesheets/yanching/reward_styles.css" rel="stylesheet" />
    <title>Reward</title>

</head>

<header class="navbar">
    <div class="logo">
        <a href="/html/simon/homepage.html">
            <img src="/medias/images/ddmainlogo.png" alt="Logo">
        </a>
    </div>

    <nav class="listeditems">
        <ul class="navlist">

            <li class="dropdown">
                <a href="/html/simon/homepage.html" class="dropdown-toggle">&nbsp;Home
                </a>
                <ul class="dropdown-menu">
                    <li><a href="/html/simon/about.html">About Us</a></li>
                    <li><a href="/html/simon/T_C.html">Terms & Conditions</a></li>
                    <li><a href="/html/karhang/faq.html">FAQS</a></li>
                    <li><a href="/html/yanching/login.html">Member</a></li>
                    <li><a href="/html/karhang/promotion.html">Promotions</a></li>
                </ul>
            </li>

            <li class="dropdown">&nbsp;Contact Us
                </a>
                <ul class="dropdown-menu">
                    <li><a href="/html/melvin/contactUs.html">Customer Support</a></li>
                    <li><a href="/html/karhang/branch.html">Locate Us</a></li>
                    <li><a href="/html/simon/feedback.html">Feedback</a></li>
                    <li><a href="/html/simon/reviews.html">Reviews</a></li>
                </ul>
            </li>

            <li class="dropdown">&nbsp;Products
                </a>
                <ul class="dropdown-menu">
                    <li><a href="/html/zhenbang/transport.html">Coffin Transportation</a></li>
                    <li><a href="/html/zhenbang/goods.html">Essential Goods</a></li>
                    <li><a href="/html/karhang/coffindesign.html">Coffins</a></li>
                    <li><a href="/html/zhenbang/columbarium.html">Columbarium</a></li>
                    <li><a href="/html/melvin/tracking.html">Tracking</a></li>
                    <li><a href="/html/melvin/grabdcar.html">Grab-D-Car</a></li>
                </ul>
            </li>

            <li class="dropdown">&nbsp;Services
                </a>
                <ul class="dropdown-menu">
                    <li><a href="/html/simon/buddhistService.html">Buddhist Service</a></li>
                    <li><a href="/html/melvin/christianService.html">Christian Service</a></li>
                    <li><a href="/html/karhang/service.html">White Ladies</a></li>
                    <li><a href="/html/karhang/service2.html">Dancing Pallbearers</a></li>
                    <li><a href="/html/yanching/exorcist.html">Exorcist</a></li>
                </ul>
            </li>
        </ul>
    </nav>
</header>

<br>

<body>
    <div class="overlay" id="overlay">
        <div class="popup" id="popup">
            <p>Thank you for becoming a member of Delightful Departure.<br><br>Enjoy your points!.</p>
            <button id="closeButton">Close</button>
        </div>
    </div>

    <div class="tagline">
        <h1>Rewards Page</h1>
    </div>

    <div class="reward-container">

        <p class="points">Your Points: <span id="userPoints">500</span></p>

        <div class="product-container">
            <div class="hidden">
                <div class="product" data-points="50">
                    <div class="rewardPic">
                        <img src="/medias/images/yanching/reward/flower 1.jpeg" alt="bouquet of flower">
                    </div>
                    <div class="productdetails">
                        <h2>Condolences Flower</h2>
                        <p>Luxurious funeral wreath of roses, lilies, chrysanthemums and mixed seasonal flowers in light
                            colors and decorative greenery.</p>
                        <p>(50 Points)</p>
                    </div>
                    <button onclick="addToCart(this)">Add to Cart</button>
                </div>
            </div>

            <div class="hidden">
                <div class="product" data-points="20">
                    <div class="rewardPic">
                        <img src="/medias/images/yanching/reward/peanut.jpeg" alt="peanut">
                    </div>
                    <div class="productdetails">
                        <h2>Peanut</h2>
                        <p>Peanut</p>
                        <p>(20 Points)</p>
                    </div>
                    <button onclick="addToCart(this)">Add to Cart</button>
                </div>
            </div>

            <div class="hidden">
                <div class="product" data-points="100">
                    <div class="rewardPic">
                        <img src="/medias/images/yanching/reward/danceTeam.jpeg" alt="Dance Team">
                    </div>
                    <div class="productdetails">
                        <h2>Dance Ritual</h2>
                        <p>Special Ritual done by our most professional funeral management team</p>
                        <p>(100 Points)</p>
                    </div>
                    <button onclick="addToCart(this)">Add to Cart</button>
                </div>
            </div>

            <div class="hidden">
                <div class="product" data-points="60">
                    <div class="rewardPic">
                        <img src="/medias/images/yanching/reward/paperHouse.jpeg" alt="Papercraft House">
                    </div>
                    <div class="productdetails">
                        <h2>House Papercraft</h2>
                        <p>Description of Product 4.</p>
                        <p>(60 Points)</p>
                    </div>
                    <button onclick="addToCart(this)">Add to Cart</button>
                </div>
            </div>

            <div class="hidden">
                <div class="product" data-points="35">
                    <div class="rewardPic">
                        <img src="/medias/images/yanching/reward/blackdancekeychain.jpeg" alt="Dance Team Keychain">
                    </div>
                    <div class="productdetails">
                        <h2>Memorable Keychain</h2>
                        <p>KeyChain with our most professional funeral management team</p>
                        <p>(35 Points)</p>
                    </div>
                    <button onclick="addToCart(this)">Add to Cart</button>
                </div>
            </div>

            <div class="hidden">
                <div class="product" data-points="200">
                    <div class="rewardPic">
                        <img src="/medias/images/yanching/reward/food.jpeg" alt="Buffet">
                    </div>
                    <div class="productdetails">
                        <h2>Buffet</h2>
                        <p>Enjoy buffet at our highclass dining restaurant just above the floor</p>
                        <p>(200 Points per pax)</p>
                    </div>
                    <button onclick="addToCart(this)">Add to Cart</button>
                </div>
            </div>
        </div>

        <!-- Shopping cart -->
        <div class="hidden">
            <div class="cart">
                <h2>Shopping Cart</h2>
                <ul id="cartItems">
                    <!-- Cart items will be displayed here -->
                </ul>
                <br>
                <p>Total Points: <span class="points" id="cartTotal">0</span></p>
                <button class="checkout" onclick="checkout()">Checkout</button>
            </div>
        </div>

        <script>

            let userPoints = localStorage.getItem('userPoints');
            if (userPoints === null) {
                userPoints = 500;
                localStorage.setItem('userPoints', userPoints);
            } else {
                userPoints = parseInt(userPoints); // Parse the stored value as an integer
            }
            // Function to update the user points in the HTML
            function updatePointsDisplay() {
                document.getElementById('userPoints').textContent = userPoints;
            }
            // Initialize the user points display when the page loads
            updatePointsDisplay();
            console.log(userPoints);
            let cartItems = [];

            function addToCart(button) {
                const product = button.parentElement;
                const productName = product.querySelector('h2').textContent;
                const productPoints = parseInt(product.getAttribute('data-points'));

                // Calculate the total points required for this product
                const totalPointsRequired = productPoints * 1; // Assuming user wants to add 1 item


                // Check if the user has enough points to add the item
                const availablePoints = calculateAvailablePoints();
                if (totalPointsRequired > availablePoints) {
                    // Display an error message
                    alert('Selected item exceeds available points.');
                    return;
                }

                // Create a cart item object
                const cartItem = {
                    name: productName,
                    points: productPoints,
                    amount: 1, // Default amount
                };

                // Check if the product is already in the cart
                const existingItemIndex = cartItems.findIndex(item => item.name === productName);

                if (existingItemIndex !== -1) {
                    // If the product is already in the cart, increment the amount
                    cartItems[existingItemIndex].amount++;
                } else {
                    // Otherwise, add the product to the cart
                    cartItems.push(cartItem);
                }

                // Refresh the cart display
                updateCartDisplay();
            }
            function updateCartDisplay() {
                const cartContainer = document.getElementById('cartItems');
                cartContainer.innerHTML = '';

                let cartTotalPoints = 0; // Initialize the cart total points

                cartItems.forEach(item => {
                    const cartItemLi = document.createElement('li');
                    cartItemLi.className = 'cart-item fade-in';

                    // Create a container for product name and points (far left)
                    const leftContainer = document.createElement('div');
                    leftContainer.className = 'left-container';

                    // Display the product name and points in the left container
                    const productNameSpan = document.createElement('span');
                    productNameSpan.textContent = item.name;
                    leftContainer.appendChild(productNameSpan);

                    const productPointsSpan = document.createElement('span');
                    productPointsSpan.textContent = `(${item.points} points)`;
                    leftContainer.appendChild(productPointsSpan);

                    cartItemLi.appendChild(leftContainer);



                    // Create a div for amount selection and remove button (far right)
                    const rightContainer = document.createElement('div');
                    rightContainer.className = 'right-container';

                    // Calculate the total points for this cart item
                    const itemTotalPoints = item.points * item.amount;
                    cartTotalPoints += itemTotalPoints;
                    // Display the total points for this cart item
                    const totalPointsSpan = document.createElement('span');
                    totalPointsSpan.className = 'totalPointsDisplay';
                    totalPointsSpan.textContent = `Total: ${item.points * item.amount} points`;
                    rightContainer.appendChild(totalPointsSpan);

                    // Create a select element for choosing the amount
                    const amountSelect = document.createElement('select');
                    amountSelect.className = 'select';
                    for (let i = 1; i <= 10; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.text = i;
                        amountSelect.appendChild(option);
                    }
                    amountSelect.value = item.amount;
                    amountSelect.addEventListener('change', function () {
                        const newAmount = parseInt(this.value);

                        // Check if the new amount exceeds available points
                        const availablePoints = calculateAvailablePoints();
                        if (newAmount * item.points > availablePoints) {
                            // Display an error message
                            alert('Selected amount exceeds available points.');

                            // Reset the select to the previous value
                            this.value = item.amount;
                            return;
                        }

                        item.amount = newAmount;
                        updateCartDisplay();
                    });

                    rightContainer.appendChild(amountSelect);




                    // Display the remove button as text
                    const removeButton = document.createElement('button');
                    removeButton.textContent = 'Remove';
                    removeButton.className = 'remove-button';
                    removeButton.onclick = function () {
                        // Remove the item from the cartItems array
                        const itemIndex = cartItems.findIndex(cartItem => cartItem.name === item.name);
                        if (itemIndex !== -1) {
                            cartItems.splice(itemIndex, 1);
                        }

                        // Refresh the cart display
                        updateCartDisplay();
                    };
                    rightContainer.appendChild(removeButton);

                    cartItemLi.appendChild(rightContainer);

                    cartContainer.appendChild(cartItemLi);
                });

                // Display the total points in the cart
                document.getElementById('cartTotal').textContent = cartTotalPoints;

                // Calculate and display the remaining user points
                const remainingPoints = calculateAvailablePoints();
                document.getElementById('userPoints').textContent = remainingPoints;

                // Update the user points displayed in the HTML
                const userPointsElement = document.getElementById('userPoints');
                if (userPointsElement) {
                    userPointsElement.textContent = remainingPoints;
                }

            }

            function calculateAvailablePoints() {
                const cartTotal = cartItems.reduce((total, item) => total + item.points * item.amount, 0);
                return userPoints - cartTotal;
            }

            function checkout() {
                // Calculate the total points required for all items in the cart
                const cartTotal = cartItems.reduce((total, item) => total + item.points * item.amount, 0);

                // Check if the user has enough points to complete the checkout
                if (cartTotal <= userPoints) {
                    // Deduct the points from the user's balance
                    userPoints -= cartTotal;

                    localStorage.setItem('userPoints', userPoints);


                    // Alert the user that the checkout is complete
                    alert("Checkout complete! Thank you for your purchase.");

                    // Clear the cartItems array
                    cartItems = [];

                    // Refresh the cart display
                    updateCartDisplay();
                    // Update the user points display
                    updatePointsDisplay();

                } else {
                    // Display an error message if the user doesn't have enough points
                    alert("Insufficient points to complete the checkout.");
                }

            }
        </script>

        <div class="disclaimer">
            <h1>Reward Point System Disclaimer</h1>
            <p>Before using our reward point system, please read and understand the following disclaimer:</p>

            <ul>
                <li><strong>Eligibility:</strong> Participation in our reward point system is open to eligible customers
                    only. You must meet the eligibility criteria outlined in our terms and conditions to earn and redeem
                    reward points.
                </li>
                <br>
                <li><strong>Point Valuation:</strong> The value of reward points may change over time and can be subject
                    to adjustments or modifications by us. We reserve the right to alter point values at our discretion
                    without prior notice.
                </li>
                <br>
                <li><strong>Account Security:</strong> It is your responsibility to maintain the security of your
                    account. Any unauthorized access, use, or redemption of your reward points due to negligence on your
                    part will not be our responsibility.
                </li>
                <br>
                <li><strong>Disclaimer of Liability:</strong> We disclaim all liability for any loss, damage, or
                    inconvenience arising from the use of our reward point system. By participating, you agree that we
                    are not responsible for any issues related to the reward point system.
                </li>
            </ul>

            <h2>Reward Points for Package</h2>

            <table>
                <tr>
                    <th>DD Package</th>
                    <th>Points Earned</th>
                </tr>
                <tr>
                    <td>DD Serenity</td>
                    <td>500 points</td>
                </tr>
                <tr>
                    <td>DD Tranquility</td>
                    <td>400 points</td>
                </tr>
                <tr>
                    <td>DD Remembrance</td>
                    <td>300 points</td>
                </tr>
                <tr>
                    <td>DD Harmony</td>
                    <td>500 points</td>
                </tr>
                <tr>
                    <td>DD Legacy</td>
                    <td>400 points</td>
                </tr>
            </table>

            <p>We encourage you to review our complete terms and conditions for our reward point system before
                participating.
                If you have any questions or concerns, please contact our customer support for assistance.</p>
        </div>

    </div>

    <div class="chat-container">
        <div class="livechat-toggle" id="chat-toggle">
            <img class="headset" src="/medias/images/icons/headset-solid.svg">
        </div>
        <div class="chat-box" id="chat-box">
            <iframe class="chat" allow="microphone;" width="300" height="300"
                src="https://console.dialogflow.com/api-client/demo/embedded/a53d9df6-d8e2-43b1-a0aa-d19412c442e6"></iframe>
        </div>
    </div>
</body>

<footer class="footer">
    <div class="footer-left">
        <img class="footerimage" src="/medias/images/ddmainlogo.png" alt="Logo">
        <h4>
            <div class="map"><img class="left-icon" src="/medias/images/icons/location-dot-solid.svg">
                <a
                    href="https://www.google.com/maps/dir/3.2201537,101.7182172/Tunku+Abdul+Rahman+University+of+Management+and+Technology+(TAR+UMT),+Ground+Floor,+Bangunan+Tan+Sri+Khaw+Kai+Boh+(Block+A),+Jalan+Genting+Kelang,+Setapak,+53300+Kuala+Lumpur,+Federal+Territory+of+Kuala+Lumpur/@3.2168247,101.7130416,15z/data=!3m1!4b1!4m9!4m8!1m1!4e1!1m5!1m1!1s0x31cc3843bfb6a031:0x2dc5e067aae3ab84!2m2!1d101.7265571!2d3.2152552?entry=ttu">&nbsp;Main
                    branch</a> /
                <a href="/html/karhang/branch.html" class="morebranches">More branches</a>
            </div>
        </h4>
    </div>
    <div class="footer-right">
        <h3>Get in touch:</h3>
        <p><a href="tel:60167719430"><img class="right-icon" src="/medias/images/icons/phone-solid.svg"></a>
            <a href="https://www.facebook.com/steve.zb.05/"><img class="right-icon"
                    src="/medias/images/icons/facebook.svg"></a>
            <a href="https://wa.me/60167719430"><img class="right-icon" src="/medias/images/icons/whatsapp.svg"></a>
        </p>
        <p>
            <a href="https://t.me/ZhenBangOwO"><img class="right-icon" src="/medias/images/icons/telegram.svg"></a>
            <a href="https://www.instagram.com/zhenbang_qr/"><img class="right-icon"
                    src="/medias/images/icons/instagram.svg"></a>
            <a href="mailto:delightfuldeparture@gmail.com"><img class="right-icon"
                    src="/medias/images/icons/envelope-solid.svg"></a>
        </p>
    </div>
</footer>

<script src="/javascript/mainscript.js"></script>
<script src="/javascript/yanching/reward/reward.js"></script>

</html>